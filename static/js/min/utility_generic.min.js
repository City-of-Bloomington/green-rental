function getCookie(t){var a=null;if(document.cookie&&""!=document.cookie)for(var e=document.cookie.split(";"),o=0;o<e.length;o++){var r=jQuery.trim(e[o]);if(r.substring(0,t.length+1)==t+"="){a=decodeURIComponent(r.substring(t.length+1));break}}return a}function csrfSafeMethod(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}function appViewModel(){var t=this;t.other_company=ko.observable(!1),t.other_company_name=ko.observable(""),t.enable_units=ko.observable(!1),t._utility=ko.observable(""),t.utility=ko.computed({read:function(){return t._utility()},write:function(a){uploading||t.save_data(),t._utility(a);var e=utility_providers[a];e&&(t._provider(e[0]),"Other"===t._provider()?t.other_company(!0):t.other_company(!1)),t.update_data()},owner:t}),t._provider=ko.observable(""),t.provider=ko.computed({read:function(){return t._provider()},write:function(a){uploading||t.save_data(),t._provider(a);var e,o=[];for(var r in utility_providers)e=utility_providers[r][0],e!==a||r in o||o.push(r);o&&"Other"!==a&&(t._utility(o[0]),t.update_data()),"Other"===a?t.other_company(!0):t.other_company(!1)},owner:t}),t.company_name=ko.computed(function(){return t.other_company()?t.other_company_name():t.provider()}),t.format="YYYY-MM-DD";var a=moment().format(t.format);t.end_date=ko.observable(a),t.start_date=ko.observable(moment().subtract(12,"months").format(t.format)),t.last_start=t.start_date(),t.last_end=t.end_date(),t.url=window.location.href.toString().split(window.location.host)[1],t.save_data=function(a){var e=t.url.replace(/edit?/g,"save");console.log(e);for(var o,r,n,d,s,i,m={},_=0;12>_;_++)s="#id_months-"+_+"-cost",i="#id_months-"+_+"-amount",r=$(s).val(),n=$(i).val(),(r||n)&&(d="#id_months-"+_+"-start_date",o=moment($(d).val()).format(t.format),m[o]={cost:parseFloat(r),amount:parseFloat(n)});$.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({utility:t.utility(),other_company:t.other_company(),company_name:t.company_name(),values:m}),dataType:"text",success:a})},t.update_data=function(){if(!uploading){var a=t.url.replace(/edit?/g,"json");$.ajax({url:a,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({utility:t.utility(),other_company:t.other_company(),company_name:t.company_name(),start:t.start_date(),end:t.end_date()}),dataType:"text",success:t.update_results})}},t.update_results=function(a){if(a=JSON.parse(a))for(var e,o,r,n,d=0;12>d;d++)o="#id_months-"+d+"-start_date",e=moment($(o).val()).format(t.format),r="#id_months-"+d+"-cost",n="#id_months-"+d+"-amount",a.hasOwnProperty(e)?($(r).val(a[e].cost),$(n).val(a[e].amount)):($(r).val(""),$(n).val(""))},t.update_rows=function(){for(var a=moment(t.start_date(),t.format),e="",o=0;12>=o;o++)e="#id_months-"+o+"-start_date",$(e).val(a.format("YYYY-MM-01")),a.add(1,"months");t.update_data()},t.update_range=ko.computed(function(){var a,e,o;t.start_date()!==t.last_start&&(a=moment(t.start_date(),t.format).add(1,"year"),e=moment(),a.isAfter(e)?(t.end_date(e.format(t.format)),t.start_date(e.subtract(1,"year").format(t.format))):t.end_date(a.format(t.format)),t.last_start=t.start_date(),t.last_end=t.end_date(),t.save_data(t.update_rows)),t.end_date()!==t.last_end&&(a=moment(t.end_date(),t.format),e=moment(),a.isAfter(e)?(t.end_date(e.format(t.format)),t.start_date(e.subtract(1,"year").format(t.format))):(o=moment(t.end_date(),t.format).subtract(1,"year"),t.start_date(o.format(t.format))),t.last_start=t.start_date(),t.last_end=t.end_date(),t.save_data(t.update_rows))}),console.log("made it here")}ko.bindingHandlers.valueWithInit={init:function(t,a,e,o){var r=a(),n=t.value;ko.isWriteableObservable(o[r])||(o[r]=ko.observable()),o[r](n),ko.applyBindingsToNode(t,{value:o[r]})}};var csrftoken=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,a){csrfSafeMethod(a.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",csrftoken)}}),ko.applyBindings(new appViewModel,document.getElementById("htmlTop"));